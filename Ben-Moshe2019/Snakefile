from os.path import join

wildcard_constraints:
    pvaltype="all|any|some",
    patient="Pt0",
    sample="GSM3454528|GSM3454529",
    celltype="Monocyte",

include: "../rules/common.smk"
include: "../rules/analysis-10x.smk"

#BINOM_PLOT = join("output", "{patient}", "{sample}", "plots", "binomial-plot-{celltype}-{celltype_of_interest}-{celltype_comparison}-{tax_level}-{method}-{kingdom}-{pvaltype}-{lfc}-{block}-{microbe_of_interest}.jpg")
FIG1D = join("output", "Pt0", "plots", "figure1d.jpg")

rule all:
    input:
        expand(SAMPLE_BINOM_MARKERS, patient="Pt0", sample="GSM3454529",
               celltype="Monocyte", celltype_of_interest="Monocyte", celltype_comparison="nonMonocyte",
               tax_level="genus", direction=["up", "down"], minprop="0.01",
               lfc="0", block="sample",
               method="PathSeq", pvaltype="any", kingdom="Bacteria"),

rule plot_figures:
    input:
        FIG1D,
        expand(SAMPLE_BINOM_PLOT, patient="Pt0", sample="GSM3454529",
               celltype="Monocyte", celltype_of_interest="Monocyte", celltype_comparison="nonMonocyte",
               tax_level="genus", direction=["up", "down"], minprop="0.01",
               lfc="0", block="sample", microbe_of_interest="Salmonella",
               method="PathSeq", pvaltype="any", kingdom="Bacteria"),
#
# rule plot_fig3c:
#     params:
#         title="Cells with UMIs mapped to Salmonella"
#     input:
#         SAMPLE_MICROBE_READ_TABLE,
#         SAMPLE_SAMPLE_METADATA
#     output:
#         BINOM_PLOT
#     script:
#         "../src/plot_binomial_result.R"

rule plot_fig1d:
    input:
        SAMPLE_SAMPLE_METADATA.format(patient="Pt0", sample="GSM3454529", tax_level="genus", method="PathSeq", kingdom="Bacteria"),
        "data/SRPRISM/Pt0/GSM3454529/CB-UMI-count-SL1344.tsv"
    output:
        FIG1D
    script:
        "src/plot_fig1d.R"


# rsync -avc --include='pathseq.txt' --include='*/' --exclude='*' helix:/data/Robinson-SB/CSI-Microbes-identification/Ben-Moshe2019/output/ data/
# rsync -avc --include='CB-UMI-count-SL1344.tsv' --include='*/' --exclude='*' helix:/data/Robinson-SB/CSI-Microbes-identification/Ben-Moshe2019/output/ data/
